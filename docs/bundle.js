!function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),o=n(2),i=n(3),a=document.getElementById("serverView"),u=a.getContext("2d"),l=document.getElementById("addClientButton"),s=function(t,e){var n=JSON.parse(JSON.stringify(e));setTimeout(function(){return t(n)},200)},c=function(t){var e,n=o.createCanvas(),a=[],u=null,l={receiveState:function(t){if(null==u)return void(u=t);for(var n=a.length;--n>=0&&t.players[e].lastInput!=a[n].uid;);if(n>=0){u=t;for(var o=n+1;o<a.length;++o)u=r.predictWorldState(a[o],e,u)}},update:function(){if(null!=u){var l=i.getLatestInputs(e%2?i.PlayerInputScheme.WASD:i.PlayerInputScheme.Arrows);u=r.predictWorldState(l,e,u),a.push(l),a.length>500&&a.splice(0,1),s(t.receiveInput,{input:l,id:e}),o.renderGameState(n,u,"Client "+e+(e%2?" (WASD)":" (Arrows)"))}}};return e=t.addClient(l),l},p=function(){var t=u,e=[],n=[],i=r.newWorldState();return{addClient:function(t){return i.players.push(r.newPlayerState()),e.push(t),n[e.length-1]={},e.length-1},receiveInput:function(t){n[t.id]=t.input},update:function(){i=r.stepWorldState(n,i);for(var a=0;a<e.length;++a)s(e[a].receiveState,i);o.renderGameState(t,i,"Server")}}}();setInterval(p.update,50),l.onclick=function(t){var e=c(p);setInterval(e.update,50)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.newWorldState=function(){return{players:[]}},e.newPlayerState=function(){return{latestInput:"",position:{x:50+100*Math.random(),y:50+100*Math.random()},velocity:{x:0,y:0},rotation:0}};var r=function(t,e){var n=JSON.parse(JSON.stringify(e));if(t.left&&(n.rotation-=10),t.right&&(n.rotation+=10),t.up){var r=Math.cos(n.rotation*Math.PI/180),o=Math.sin(n.rotation*Math.PI/180);n.position.x+=10*r,n.position.y+=10*o}return n.lastInput=t.uid,n};e.stepWorldState=function(t,e){for(var n=JSON.parse(JSON.stringify(e)),o=0;o<n.players.length;++o)n.players[o]=r(t[o],n.players[o]);return n},e.predictWorldState=function(t,e,n){var o=JSON.parse(JSON.stringify(n));return o.players[e]=r(t,o.players[e]),o}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(t,e){var n=15*Math.cos(e.rotation*Math.PI/180),r=15*Math.sin(e.rotation*Math.PI/180);t.lineWidth=2,t.beginPath(),t.moveTo(e.position.x-n,e.position.y-r),t.lineTo(e.position.x,e.position.y),t.strokeStyle="#f99",t.stroke(),t.beginPath(),t.moveTo(e.position.x,e.position.y),t.lineTo(e.position.x+n,e.position.y+r),t.strokeStyle="#99f",t.stroke()};e.createCanvas=function(){var t=document.createElement("canvas");return t.width=200,t.height=200,document.getElementById("views").appendChild(t),t.getContext("2d")},e.renderGameState=function(t,e,n){t.clearRect(0,0,200,200);for(var o=0;o<e.players.length;++o)r(t,e.players[o]);t.font="12px monospace",t.fillStyle="#fff",t.fillText(n,2,12)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r;!function(t){t[t.WASD=0]="WASD",t[t.Arrows=1]="Arrows"}(r=e.PlayerInputScheme||(e.PlayerInputScheme={}));var o={};document.onkeydown=function(t){return o[t.keyCode]=!0},document.onkeyup=function(t){return delete o[t.keyCode]};var i=function(){return Math.random().toString(36).substr(2)},a=function(){return{up:!0===o[87],down:!1,left:!0===o[65],right:!0===o[68],shoot:!1,uid:i()}},u=function(){return{up:!0===o[38],down:!1,left:!0===o[37],right:!0===o[39],shoot:!1,uid:i()}};e.getLatestInputs=function(t){return t===r.WASD?a():u()}}]);
//# sourceMappingURL=bundle.js.map